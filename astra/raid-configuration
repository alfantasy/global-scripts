#!/bin/bash

if [ "$(id -u)" != "0" ]; then
    echo -e "\033[1;37mСкрипт должен иметь права суперпользователя (root).\033[0m" 1>&2
    echo -e "\033[1;34mЗапустите скрипт через sudo или зайдите под суперпользователя и повторите попытку.\033[0m" 1>&2
    exit 1
fi

read -t 10 -p "Введите имя установленного LVM Volume Group: " MANUAL_VG_ID

if [ -n "$MANUAL_VG_ID" ]; then
    MAIN_LVM_VGID="$MANUAL_VG_ID"
    echo -e "\033[1;37mИспользуется мануальный главный LVM Volume Group: $MAIN_LVM_VGID\033[0m"
else
    MAIN_LVM_VGID=$(lsblk -o NAME -n -r | grep -oP 'VG\K[0-9]+(?=-lv_)' | sort -u)
    if [ -z "$MAIN_LVM_VGID" ]; then
        echo -e "\033[1;37mНе удалось определить главный LVM Volume Group.\033[0m" 1>&2
        exit 1
    else
        echo -e "\033[1;37mИспользуется главный LVM Volume Group: $MAIN_LVM_VGID\033[0m"
    fi    
fi

