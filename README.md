# 🧰 Global Scripts

Коллекция полезных системных скриптов для Linux (в первую очередь Astra Linux), упрощающих рутинные задачи и автоматизирующих настройку.

---

## 📜 Список доступных скриптов

### 1. 🖥️ Fix Resolution — автоматическая установка разрешения экрана

Скрипт `fix-resolution` поддерживает фиксированное разрешение **1920x1080** (по умолчанию) на всех подключённых мониторах.  
Работает как systemd-сервис, отслеживает изменения конфигурации мониторов и применяет нужные параметры без участия пользователя.

#### 🔧 Возможности:
- Принудительно устанавливает 1920x1080 для всех экранов (можно поменять)
- Отслеживает hotplug (переподключения/переключения мониторов)
- Генерирует xorg-конфиг в `/etc/X11/xorg.conf.d/`
- Создаёт systemd-сервис `resolution-fix.service`
- Создаёт свой конфигурационный файл `/etc/fix-resolution.conf`
- Подмена фиксированных значений:
```bash
fix-resolution --config set RESOLUTION 1280x720 && \
fix-resolution --config set RATE 59
```
- Поддерживает Astra Linux, Fly-DM и headless сценарии

#### 📥 Установка:

```bash
wget -O /usr/local/bin/fix-resolution https://raw.githubusercontent.com/alfantasy/global-scripts/refs/heads/main/astra/fix-resolution && \
sudo chmod +x /usr/local/bin/fix-resolution && \
/usr/local/bin/fix-resolution --help
```

### 2. ⚙ RAID Configuration — автоматическая конфигурация RAID-массива первого уровня

Скрипт `raid-configuraton` автоматически конфигурирует RAID-массив первого уровня (зеркалирование) при условии, если сама система установлена на LVM том.
Скрипт восстанавливает LVM-том на RAID-массиве с полной миграцией разметок диска при их отсутствии с диска на диск, а также имеет две части установки:
1. Доперезагрузочная реализация (pre-reboot): разметка диска, создание деградированного RAID-массива, LVM-тома, перенос данных с диска на диск, обновление загрузчика
2. Послеперезагрузочная реализация (post-reboot): посекторная миграция загрузочных разделов, дополнительный загрузчик и восстановление деградированного массива

Скрипт имеет разделение на ввод пользователя и полное автоматическое конфигурирование с теми переменными, которые у него уже есть.

Послеперезагрузочная реализация запускается автоматически после перезагрузки и выполнения доперезагрузочной реализации.
#### Пропускать этапы нельзя!

#### Важно: 
Скрипт должен быть запущен от имени суперпользователя или с правами sudo, желательно бы, чтобы PC был подключен к Интернету, иначе пакет mdadm будет устанавливаться прямо изнутри самого скрипта с извлечением Base64-пакета формата .deb.
Данный скрипт работает только на системах Debian с обозначением всех LVM-томов и умеет переносить только LVM-тома. С другими разделами скрипт не работает и развиваться в том направлении не БУДЕТ! Работоспособность проверена на системе Astra Linux 1.8 уровня защищенности "Воронеж".

#### 🔧 Возможности:
- Автоматическая установка специального пакета madm, как с наличием интернета, так и без него
- Автоматический захват основной VG-группы LVM
- Автоматическая настройка RAID-массива первого уровня
- Реализация разметки диска и посекторного восстановление загрузочных разделов
- Автоматическая регистрация загрузчика
- Восстановление деградированного массива
- Логгирование действий

#### 📥 Установка:
```bash
wget -O /usr/local/bin/raid-configuration https://raw.githubusercontent.com/alfantasy/global-scripts/refs/heads/main/astra/raid-configuration && \
sudo chmod +x /usr/local/bin/raid-configuration && \
/usr/local/bin/raid-configuration --help
```

### 3. 🤖 Waydroid Installer - универсальный установщик Waydroid - контейнера Android на основе LXC.

Скрипт `waydroid-installer.sh` автоматически заносит все необходимые изменения для Waydroid в систему, добавляя их репозиторий в apt, полностью автоматизируя процесс установки ПО.
Скрипт выполняется единожды и не требует вмешательства пользователя.

#### 🔧 Возможности:
- Проверка наличия включенной вложенной/нативной виртуализации
- Добавление репозитория Waydroid
- Установка необходимых пакетов и их обновление
- Установка Waydroid
- Вспомогательная справка

#### 📥 Установка и автозапуск:
```bash
wget -O waydroid-installer.sh https://raw.githubusercontent.com/alfantasy/global-scripts/refs/heads/main/debian/waydroid-installer.sh && \
sudo chmod +x waydroid-installer.sh && \
./waydroid-installer.sh
```

#### 📥  Только скачивание:
```bash
wget -O waydroid-installer.sh https://raw.githubusercontent.com/alfantasy/global-scripts/refs/heads/main/debian/waydroid-installer.sh
```

### 4. L2TP/IPSec manager - универсальный специальный скрипт-менеджер для установления клиентского соединения VPN.

Скрипт `l2tp-ipsec-manager` позволяет быстро настроить VPN-соединение L2TP/IPSec с средствами отладки и заготовками, автоматически поднимает и проверяет соединение.
Имеет свой файл конфигурации `/etc/l2tp-ipsec-manager.conf`, где прописываются следующие параметры:
```bash
IPSEC_SERVICE=ipsec # Базовый сервис запуска IPSec // StrongSwan
IPSEC_DAEMON=charon # Базовый демон запуска IPSec // Charon
L2TP_SERVICE=xl2tpd # Базовый сервис запуска L2TP // xl2tpd
LOG_FILE="/var/log/l2tp-ipsec-restart.log" # Файл логов
L2TP_TUNNEL=mytunnel # Имя туннеля L2TP
IPSEC_CONN=myconn # Имя соединения IPSec
IP_SERVER="127.0.0.1" # IP-адрес сервера для восстановления маршрута в PPP-соединении.
```

#### Для запуска скрипта используйте:
```bash
chmod +x l2tp-ipsec-manager.sh
./l2tp-ipsec-manager.sh
```

#### Важно!
Скрипт невыгружаемый и запускается единожды. Автозапуск настраивайте самостоятельно.

### 5. ⚙ FileSystem Config - специальный уникальный скрипт для контроллеров WirenBoard.

Скрипт `fs-config` позволяет автоматически и быстро переконфигурировать файловую систему с способностью перемещения тяжелых директорий на свободное пространство в /tmp (eMMC).

#### Внимание!
Скрипт небезопасен для неопытных пользователей, поскольку он смещает директории, создавая на них символические ссылки для стабильности работы всех пакетов.
Если Вы не уверены в своих действиях, то рекомендуем не использовать этот скрипт.

#### Запуск:
```bash
chmod +x fs-config.sh
./fs-config.sh
```
